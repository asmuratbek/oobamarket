{% extends 'base-1.html' %}
{% load product_tags staticfiles %}

{% block meta %}
    <meta name="description" content="






            {% if object.meta_description %}{{ object.meta_description }}{% else %}{{ object.category.section }}, {{ object.category.parent }}, {{ object.category }}- {{ object.short_description }} {{ object.price }} {{ object.currency }} Бишкек, в Бишкеке{% endif %}">
    <meta name="keywords" content="






            {% if object.meta_keywords %}{{ object.meta_keywords }}{% else %}{{ object.title }},{{ object.get_shop_title }},интернет магазин, купить, в бишкеке, цена, отзывы{% endif %}">
    <meta name="author" content="Oobamarket.kg интернет магазин в Бишкеке">
    <title>{% block title %}{% if object.meta_title %}{{ object.meta_title }} в Бишкеке -
        {{ object.get_shop_title }}{% else %}{{ object.title }} - {{ object.get_shop_title }} интернет-магазин Бишкек
    {% endif %} {% endblock %}</title>
{% endblock %}

{% block header %}
    {% include 'layout/header.html' with global=object.shop.get_global_category %}
{% endblock %}



{% block categories %}
    <section class="dropdown-category">
        <div class="uk-container">
            <div class="uk-text-center uk-flex-middle uk-grid uk-visible@l" uk-grid>
                {% include 'layout/categories.html' with object=object.shop.get_global_category %}
            </div>
        </div>
    </section>
{% endblock %}

{% block content %}
    <section class="product-detail shadow uk-margin-medium-top">
        <div class="uk-container">
            <div class="uk-grid">
                <div class="uk-width-1-3@l image-zoom uk-width-1-1@m">
                    {% if object.get_avatar_image %}
                        <img class="zoom-parent"
                             src="{{ object.get_avatar_image }}"
                             data-large="{{ object.get_avatar_image }}" title="Фото">
                    {% else %}
                        <img class="zoom-parent"
                             src="http://via.placeholder.com/378x378"
                             data-zoom-image="http://via.placeholder.com/378x378"/>
                    {% endif %}
                    <div id="child-gallery">
                        {% for image in object.productimage_set.all %}
                            <img {% if image.is_avatar %} active {% endif %} class="zoom-children"
                                                          src="{{ image.image.url }}"
                                                          data-large="{{ image.image.url }}" title="">
                        {% endfor %}
                    </div>
                </div>

                <div class="uk-width-2-5@l uk-width-1-2@m about-product">
                    <ul class="uk-breadcrumb uk-margin-small-bottom">
                        <li>
                            <a href="{{ object.category.section.get_absolute_url }}">{{ object.category.section.title }}</a>
                        </li>
                        <li><a href="{{ object.shop.get_absolute_url }}">{{ object.get_shop_title }}</a></li>
                        <li class="active">{{ object.title }}</li>
                    </ul>
                    <h1>{{ object.title }}
                        {% if user.is_authenticated %}
                            {% if user in object.shop.user.all %}
                                <a href="{% url 'product:update_product' slug=object.slug %}" uk-icon="icon: file-edit"
                                   title="Редактировать товар" uk-tooltip></a>
                            {% endif %}
                        {% endif %}
                    </h1>
                    {% if object.discount %}
                        <span class="price">{{ object.get_price }} {{ object.currency }}</span>
                        <strike>{{ object.price }} {{ object.currency }}</strike>
                    {% else %}
                        <span class="price">{{ object.get_price }} {{ object.currency }}</span>
                    {% endif %}


                    <div class="availability">
                        <p>Наличие: <b class="green">В наличии</b></p>
                        <p>Наличие: <b class="red">Нет в наличие</b></p>
                        <p>Наличие: <b class="gray">Ожидание</b></p>
                    </div>
                    {% if object.short_description %}
                        <p class="short-description">
                            <strong>Короткое описание:</strong><br> {{ object.short_description|safe }}
                        </p>
                    {% endif %}
                    {#                    <div class="availability">#}
                    {#                    <span>Наличие: #}
                    {#                        <span class="{% if object.availability == "available" %} stock#}
                    {#                                                {% elif object.availability == "waiting" %} expectation#}
                    {#                                                {% else %} not-stock {% endif %}">{{ object.get_availability }}</span>#}
                    {#                    </span>#}
                    {##}
                    {#                        <!-- <span class="truck">#}
                    {#                    <i class="fa fa-truck {% if product.delivery_type == 'paid' %} yellow#}
                    {#                    {% elif product.delivery_type == 'free' %} green {% endif %}" aria-hidden="true"></i>#}
                    {#                    {{ object.get_delivery_type }}#}
                    {#                </span> -->#}
                    {#                    </div>#}
                    <!-- {% if product.delivery_type == 'paid' %}
                    <p>Стоимость доставки:{{ product.delivery_cost }}</p>
                {% endif %} -->
                    <form action="" id="favorite-form" style="display: none;">
                        <input type="hidden" name="item" value="{{ object.id }}">
                    </form>
                    <div class="uk-button-group uk-margin-medium-top add basket favorite uk-grid">
                        <div class="uk-width-1-2@l uk-width-1-2@m uk-width-1-2@s">{% is_in_cart request object %} </div>
                        <div class="uk-width-1-2@l uk-width-1-2@m uk-width-1-2@s">{% is_favorite object request.user %}</div>
                    </div>
                </div>
                <div class="uk-width-1-4@l uk-width-1-2@m">
                    <div class="shop-list" title="Перейти в магазин" uk-tooltip>
                    <h3>Магазин / Продавец:</h3>
                        <div class="uk-grid-match">
                            <div class="shadow uk-text-center uk-transition-toggle">
                                <div class="uk-inline-clip uk-transition-toggle">
                                    <div class="border">
                                        <div class="uk-cover-container">
                                            <canvas width="400" height="400"></canvas>
                                            <img uk-cover src="{{ object.shop.get_logo }}" alt="">
                                        </div>
                                    </div>
                                    <div class="uk-transition-fade uk-position-cover uk-overlay uk-overlay-default">
                                        <a href="{{ object.shop.get_absolute_url }}" class="uk-position-cover"></a>
                                        <h4 class="uk-margin-remove">{{ object.shop.title|truncatechars:28 }}</h4>
                                        <div class="control">
                                            {% if object.shop.contacts_set.first.phone %}
                                                <p class="phone"><span class="uk-margin-small-right"
                                                                       uk-icon="icon: phone"></span>
                                                    {{ object.shop.contacts_set.first.phone }}
                                                </p>
                                            {% else %}
                                                <p class="phone"><span class="uk-margin-small-right"
                                                                       uk-icon="icon: phone"></span>
                                                    не указан
                                                </p>
                                            {% endif %}
                                                <p class="email">
                                                    <span class="uk-margin-small-right" uk-icon="icon: mail"></span>
                                                    {{ object.shop.email }}
                                                </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-padding-small uk-grid uk-margin-remove footer">
                                    <h4 class="uk-width-1-1@l uk-padding-remove">
                                        {{ object.shop.title|truncatechars:28 }}</h4>

                                    {% if user.is_authenticated %}
                                        {% if user not in object.shop.user.all %}
                                            {% if object.shop.id in subscribe_shops %}
                                                <a class="subscribe_shop uk-display-block disabled">Подписаны</a>
                                            {% else %}
                                                <a class="subscribe_shop uk-display-block enable">Подписаться</a>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ck-editor uk-margin-medium-top">
        <div class="uk-container">
            <div class="content shadow uk-padding-large">
                {{ object.long_description | safe }}
            </div>
        </div>
    </section>

{#    <section class="reviews">#}
{#        <div class="container bg-white" id="prod_review">#}
{#            {% include 'layout/prod_reviews.html' %}#}
{#        </div>#}
{#    </section>#}
{##}
{#    <section class="reviews edit">#}
{#        <div class="container bg-white">#}
{#            <div class="item">#}
{#                <form id='review_form' class="product_review" action="{% url 'product:add_review' slug=object.slug %}"#}
{#                      method="post">#}
{#                    {% csrf_token %}#}
{##}
{#                    {% if user.is_authenticated %}#}
{#                        <div class="name">#}
{#                            <h5>Добавить отзыв</h5>#}
{##}
{#                            <h4>#}
{##}
{#                                <div class="star-wrapper">#}
{#                                    <div class="star default">#}
{#                                        <i class="fa fa-star-o" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star-o" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star-o" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star-o" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star-o" aria-hidden="true"></i>#}
{#                                    </div>#}
{#                                    <div class="star active star-behaviour" data-save-stars="false"#}
{#                                         data-stars-count="0">#}
{#                                        <i class="fa fa-star" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star" aria-hidden="true"></i>#}
{#                                        <i class="fa fa-star" aria-hidden="true"></i>#}
{#                                    </div>#}
{#                                </div>#}
{##}
{#                            </h4>#}
{##}
{#                        </div>#}
{#                        <div class="description">#}
{##}
{#                            <div class="form-group">#}
{#                                <textarea name="text" id="prod-rev" cols="30" rows="10" class="form-control"></textarea>#}
{##}
{#                            </div>#}
{#                            <button type="submit">Отправить</button>#}
{#                        </div>#}
{#                    {% else %}#}
{#                        <div class="name">#}
{#                            <h5>Чтобы добавить отзыв авторизуйтесь</h5>#}
{#                        </div>#}
{#                    {% endif %}#}
{#                </form>#}
{#            </div>#}
{##}
{#        </div>#}
{#    </section>#}
<section class="review uk-margin-medium-top">

    <div class="uk-container">
        <div class="shadow uk-padding-large">
            <article class="uk-comment">
                <h4 class="uk-comment-title uk-margin-remove">
                    Автор
                    <div class="group-star uk-display-inline-block">
                        <span class="star"></span>
                        <span class="star"></span>
                        <span class="star"></span>
                        <span class="star"></span>
                    </div>
                </h4>
                <ul class="uk-comment-meta uk-subnav uk-subnav-divider uk-margin-remove-top">
                    <li><a href="#">22.09.17 12:09</a></li>
                </ul>
                <div class="uk-comment-body">
                    <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt
                        ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo
                        dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor
                        sit amet.</p>
                </div>
                <hr class="uk-divider-icon">
            </article>

            <article class="uk-comment">
                <h4 class="uk-comment-title uk-margin-remove">
                    Автор
                    <div class="group-star uk-display-inline-block">
                        <span class="star"></span>
                        <span class="star"></span>
                        <span class="star"></span>
                        <span class="star"></span>
                        <span class="star"></span>
                    </div>
                </h4>
                <ul class="uk-comment-meta uk-subnav uk-subnav-divider uk-margin-remove-top">
                    <li><a href="#">12 дней назад</a></li>
                </ul>
                <div class="uk-comment-body">
                    <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt
                        ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo
                        dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor
                        sit amet.</p>
                </div>
                <hr class="uk-divider-icon">
            </article>

            <form class="uk-form-stacked uk-margin-medium-top">
                <div class="uk-margin">
                    <legend class="uk-legend">Добавить отзыв</legend>
                    <select id="rating-review" class="uk-margin">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <div class="uk-form-controls">
                        <textarea class="uk-textarea" rows="10" placeholder="Ваш отзыв"></textarea>
                    </div>
                </div>
                <button class="uk-button uk-button-default">Отправить</button>
            </form>
        </div>


    </div>
</section>
{% endblock content %}


{% block js %}
    {{ block.super }}
    {#    <script src={% static 'js/jquare-zoom.js' %}></script>#}
    {#    <script src={% static 'js/subscribe.js' %}></script>#}
    <script src="{% static 'js/main.js' %}"></script>


    <script>
        var form = $('#review_form');
        $(form).unbind('submit').bind('submit', function (event) {
            var data = $(form).serialize();
            console.log(data);
            data += '&rating=' + $('.star-behaviour').getRating();
            console.log(data);
            event.preventDefault();
            console.log('Send data function is called!');
            $.ajax({
                method: 'POST',
                url: $(form).attr('action'),
                dataType: 'JSON',
                data: data,
                success: function (response) {
                    console.log(response);
                    if (response.success) {
                        $.ajax({
                            method: 'POST',
                            dataType: 'HTML',
                            url: '{% url "product_reviews" %}',
                            data: {'csrfmiddlewaretoken': '{{ csrf_token }}', 'product': '{{ object.slug }}'},
                            success: function (response) {
                                console.log(response);
                                $('#prod_review').html(response);
                            },
                            error: function () {
                                console.error('Can\'t send ajax to load all comments');
                            }
                        });
                        $('.star-behaviour').clearRating();
                        $('#prod-rev').val('');
                    } else if (response.url) {
                        document.location.href = response.url;
                    }
                }
            });
        });


    </script>

{% endblock %}
